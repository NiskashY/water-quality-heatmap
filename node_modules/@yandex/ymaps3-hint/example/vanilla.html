<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
        <script src='https://api-maps.yandex.ru/v3/?apikey=%APIKEY%&lang=en_US'></script>
        <script src="common.js"></script>
        <title>Test</title>
        <script>
            window.map = null;

            main();
            async function main() {
                await ymaps3.ready;
                const {
                    YMap,
                    YMapDefaultSchemeLayer,
                    YMapDefaultFeaturesLayer,
                    YMapControls,
                    YMapCollection,
                    YMapMarker,
                    YMapFeature,

                    YMapEntity
                } = ymaps3;

                const {YMapZoomControl} = await ymaps3.import('@yandex/ymaps3-controls@0.0.1');
                const {YMapHint, YMapHintContext} = await ymaps3.import('@yandex/ymaps3-hint@0.0.1');

                map = new YMap(document.getElementById('app'), {location: LOCATION});

                map.addChild(new YMapDefaultSchemeLayer());
                map.addChild((defaultFeatures = new YMapDefaultFeaturesLayer()));

                map.addChild(new YMapControls({position: 'right'}).addChild(new YMapZoomControl({})));

                const bounds = map.bounds;

                const markers = new YMapCollection({});
                POINTS.forEach(({coordinates, hint, color}) => {
                    const marker = new YMapMarker({coordinates, properties: {hint}});
                    marker.element.style.transform = 'translate(-15px, -33px)';
                    marker.element.style.position = 'absolute';
                    marker.element.innerHTML = markerSvg(color);

                    markers.addChild(marker);
                });

                const lines = new YMapCollection({});
                LINES.forEach(({geometry, hint, style}) => {
                    lines.addChild(new YMapFeature({geometry, style, properties: {hint}}));
                });

                const triangles = new YMapCollection({});
                TRIANGLES.forEach(({geometry, hint, style}) => {
                    triangles.addChild(new YMapFeature({geometry, style, properties: {hint}}));
                });

                map.addChild(markers);
                map.addChild(lines);
                map.addChild(triangles);

                map.addChild(
                    (hint = new YMapHint({
                        layers: [defaultFeatures.layer],
                        hint: (object) => object?.properties?.hint
                    }))
                );

                hint.addChild(
                    new (class MyHint extends YMapEntity {
                        _onAttach() {
                            this._element = document.createElement('div');
                            this._element.className = 'my-hint';

                            this._detachDom = ymaps3.useDomContext(this, this._element);
                            this._watchContext(
                                YMapHintContext,
                                () => {
                                    this._element.textContent = this._consumeContext(YMapHintContext)?.hint;
                                },
                                {immediate: true}
                            );
                        }
                        _onDetach() {
                            this._detachDom();
                        }
                    })()
                );
            }
        </script>

        <link rel="stylesheet" href="common.css" />
    </head>
    <body>
        <div id="app"></div>
    </body>
</html>
