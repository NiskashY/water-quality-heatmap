<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
        <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
        <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
        <script crossorigin src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
        <script src='https://api-maps.yandex.ru/v3/?apikey=%APIKEY%&lang=en_US'></script>
        <script src="common.js"></script>

        <script type="text/babel">
            window.map = null;

            main();
            async function main() {
                const [ymaps3React] = await Promise.all([ymaps3.import('@yandex/ymaps3-reactify'), ymaps3.ready]);
                const reactify = ymaps3React.reactify.bindTo(React, ReactDOM);
                const {
                    YMap,
                    YMapDefaultSchemeLayer,
                    YMapDefaultFeaturesLayer,
                    YMapControls,

                    YMapCollection,
                    YMapMarker,
                    YMapFeature
                } = reactify.module(ymaps3);
                const {useState, useCallback} = React;

                const {YMapZoomControl} = reactify.module(await ymaps3.import('@yandex/ymaps3-controls@0.0.1'));
                const {YMapHint, YMapHintContext} = reactify.module(await ymaps3.import('@yandex/ymaps3-hint@0.0.1'));
                ReactDOM.render(
                    <React.StrictMode>
                        <App />
                    </React.StrictMode>,
                    document.getElementById('app')
                );

                function App() {
                    const [location, setLocation] = useState(LOCATION);

                    const getHint = useCallback((object) => object && object.properties && object.properties.hint, []);

                    return (
                        <YMap location={location} ref={(x) => (map = x)}>
                            <YMapDefaultSchemeLayer />
                            <YMapDefaultFeaturesLayer />
                            <YMapControls position="right">
                                <YMapZoomControl />
                            </YMapControls>

                            <YMapHint hint={getHint}>
                                <MyHint />
                            </YMapHint>

                            <YMapCollection>
                                {POINTS.map(({coordinates, hint, color}, ix) => (
                                    <MyMarker key={ix} coordinates={coordinates} properties={{hint}} color={color} />
                                ))}
                            </YMapCollection>
                            <YMapCollection>
                                {LINES.map(({geometry, hint, style}, ix) => (
                                    <YMapFeature key={ix} geometry={geometry} style={style} properties={{hint}} />
                                ))}
                            </YMapCollection>
                            <YMapCollection>
                                {TRIANGLES.map(({geometry, hint, style}, ix) => (
                                    <YMapFeature key={ix} geometry={geometry} style={style} properties={{hint}} />
                                ))}
                            </YMapCollection>
                        </YMap>
                    );
                }
                function MyMarker({coordinates, properties, color}) {
                    return (
                        <YMapMarker properties={properties} coordinates={coordinates}>
                            <div
                                dangerouslySetInnerHTML={{__html: markerSvg(color)}}
                                style={{transform: 'translate(-15px, -33px)', position: 'absolute'}}
                            ></div>
                        </YMapMarker>
                    );
                }
                function MyHint() {
                    const ctx = React.useContext(YMapHintContext);
                    return <div className="my-hint">{ctx && ctx.hint}</div>;
                }
            }
        </script>

<!--        <link rel="stylesheet" href="../common.css" />-->
        <link rel="stylesheet" href="common.css" />
    </head>
    <body>
        <div id="app"></div>
    </body>
</html>
